<!DOCTYPE html>
<html class="height-full" lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Actions annotation previewer</title>
  <link media="all" rel="stylesheet" href="frameworks.css">
  <link media="all" rel="stylesheet" href="github.css">
</head>
<body class="d-flex flex-column height-full">
  <main class="container my-6 px-4 flex-1">

    <h1>GitHub Actions annotation previewer</h1>
    <p>
      Easily preview <a href="https://docs.github.com/en/actions/reference/workflow-commands-for-github-actions#setting-an-error-message">error</a> and <a href="https://docs.github.com/en/actions/reference/workflow-commands-for-github-actions#setting-a-warning-message">warning</a> annotation commands without having to run a workflow.
    </p>

    <div class="js-preview-container mt-6">
      <div class="border rounded-1">
        <div class="blankslate">
          <svg class="octicon octicon-file-code blankslate-icon" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z"></path></svg>
          <h3 class="mb-1">No preview</h3>
          <p>Paste an annotation command below to see a preview of it</p>
        </div>
      </div>
    </div>

    <div class="mt-6">
      <div class="form-group">
        <textarea class="js-command-text form-control" placeholder="Paste command here..."></textarea>
      </div>

      <div class="form-actions">
        <button class="js-btn-preview btn btn-primary" type="button">Preview annotation</button>
        <button class="js-btn-sample btn" type="button">View example</button>
      </div>
    </div>

  </main>

  <footer class="container px-4">
    <p>
      Built by <a href="https://github.com/xt0rted">xt0rted</a>,
      view on <a href="https://github.com/xt0rted/annotation-previewer">GitHub</a>
    </p>
  </footer>

  <template class="js-preview-template-error">
    <div class="Details js-details-container Box position-relative check-annotation check-annotation-failure my-2">
      <p class="text-small pl-3 my-2">
        <span class="annotation-octicon text-center d-inline-block">
          <svg class="octicon octicon-x text-red" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>
        </span>

        <a class="text-gray-light d-inline-block ml-1">Check failure on line <span class="js-preview-line"></span> in <span class="js-preview-file"></span></a>
      </p>

      <div class="annotation-actions position-absolute">
        <a class="tooltipped tooltipped-w d-inline-block ml-2" aria-label="See this annotation in the file changed.">
          <svg class="octicon octicon-file-code text-gray-light" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z"></path></svg>
        </a>
      </div>

      <p class="ml-3 mb-2 pl-4 mr-2 flex-shrink-0 d-flex flex-items-center">
        <img src="https://avatars2.githubusercontent.com/in/15368?v=4" width="20" height="20" alt="@github-actions" class="avatar mr-2 flex-shrink-0">
        <span class="mr-1 text-bold"> github-actions </span> / preview
      </p>

      <p class="ml-3 mb-0 pl-4 text-bold d-flex flex-items-center">
        <span class="annotation-title flex-auto pr-2">
          <span class="js-preview-file"></span>#L<span class="js-preview-line"></span>
        </span>
      </p>

      <div class="py-2 pl-4 ml-3">
        <code><pre class="js-preview-message"></pre></code>
      </div>
    </div>
  </template>

  <template class="js-preview-template-warning">
    <div class="Details js-details-container Box position-relative check-annotation check-annotation-warning my-2">
      <p class="text-small pl-3 my-2">
        <span class="annotation-octicon text-center d-inline-block">
          <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path></svg>
        </span>

        <a class="text-gray-light d-inline-block ml-1">Check warning on line <span class="js-preview-line"></span> in <span class="js-preview-file"></span></a>
      </p>

      <div class="annotation-actions position-absolute">
        <a class="tooltipped tooltipped-w d-inline-block ml-2" aria-label="See this annotation in the file changed.">
          <svg class="octicon octicon-file-code text-gray-light" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z"></path></svg>
        </a>
      </div>

      <p class="ml-3 mb-2 pl-4 mr-2 flex-shrink-0 d-flex flex-items-center">
        <img src="https://avatars2.githubusercontent.com/in/15368?v=4" width="20" height="20" alt="@github-actions" class="avatar mr-2 flex-shrink-0">
        <span class="mr-1 text-bold"> github-actions </span> / preview
      </p>

      <p class="ml-3 mb-0 pl-4 text-bold d-flex flex-items-center">
        <span class="annotation-title flex-auto pr-2">
          <span class="js-preview-file"></span>#L<span class="js-preview-line"></span>
        </span>
      </p>

      <div class="py-2 pl-4 ml-3">
        <code><pre class="js-preview-message"</pre></code>
      </div>
    </div>
  </template>

  <script>
    const container = document.querySelector(".js-preview-container");
    const commandText = document.querySelector(".js-command-text");
    const previewButton = document.querySelector(".js-btn-preview");
    const sampleCommand = document.querySelector(".js-btn-sample");

    sampleCommand.addEventListener("click", event => {
      commandText.value = "::warning::XUnitTestProject.UnitTests.Test%0A%0AFramework: .NETCoreApp 3.1.0%0APlatform: X64%0A%0AStandard Output Messages:%0A%0ATesting...%0A%0ADuration: 1ms";
      commandText.focus();
      previewButton.dispatchEvent(new MouseEvent("click"));
    });

    previewButton.addEventListener("click", event => {
      try {
        parseCommand(commandText.value);
      } catch {
        alert("Invalid command format");
      }
    });

    function parseCommand(command) {
      if (!command) {
        return;
      }

      const [, typeDetails, message] = command.split("::");
      const [type, attributeDetails] = typeDetails.split(" ");
      const attributes = (attributeDetails || "").split(",");

      const template = document.querySelector(type === "error" ? ".js-preview-template-error" : ".js-preview-template-warning");
      const annotation = template.content.cloneNode(true);

      annotation.querySelector(".js-preview-message").textContent = decodeURIComponent(message);

      let file = ".github";
      let line = 1;
      attributes.forEach(attribute => {
        const [key, val] = attribute.split("=");

        if (key === "file") {
          file = decodeURIComponent(val);
        } else if (key === "line") {
          line = decodeURIComponent(val);
        } else if (key === "col") {
          line = decodeURIComponent(val);
        }
      });

      annotation.querySelectorAll(".js-preview-file").forEach(element => element.innerText = file);
      annotation.querySelectorAll(".js-preview-line").forEach(element => element.innerText = line);

      container.innerHTML = "";
      container.appendChild(annotation);
    }
  </script>
</body>
</html>
